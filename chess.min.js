/*! chess 04-08-2013 */
!function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?(this._wrapped=a,void 0):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.5.1";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?void 0:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var C=function(a,b,c,d){var e={},f=B(null==b?x.identity:b);return y(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};x.groupBy=function(a,b,c){return C(a,b,c,function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)})},x.countBy=function(a,b,c){return C(a,b,c,function(a,b){x.has(a,b)||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:new Date,g=null,f=a.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e=null;return function(){var f=this,g=arguments,h=function(){e=null,c||(d=a.apply(f,g))},i=c&&!e;return clearTimeout(e),e=setTimeout(h,b),i&&(d=a.apply(f,g)),d}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push(a[c]);return b},x.pairs=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push([c,a[c]]);return b},x.invert=function(a){var b={};for(var c in a)x.has(a,c)&&(b[a[c]]=c);return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h))return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(a,b){if("object"==typeof exports&&exports)b(exports);else{var c={};b(c),"function"==typeof define&&define.amd?define(c):a.Mustache=c}}(this,function(a){function b(a,b){return t.call(a,b)}function c(a){return!b(p,a)}function d(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function e(a){return String(a).replace(/[&<>"'\/]/g,function(a){return w[a]})}function f(a){this.string=a,this.tail=a,this.pos=0}function g(a,b){this.view=a||{},this.parent=b,this._cache={}}function h(){this.clearCache()}function i(b,c,d,e){for(var f,g,h,j="",k=0,l=b.length;l>k;++k)switch(f=b[k],g=f[1],f[0]){case"#":if(h=d.lookup(g),"object"==typeof h)if(v(h))for(var m=0,n=h.length;n>m;++m)j+=i(f[4],c,d.push(h[m]),e);else h&&(j+=i(f[4],c,d.push(h),e));else if("function"==typeof h){var o=null==e?null:e.slice(f[3],f[5]);h=h.call(d.view,o,function(a){return c.render(a,d)}),null!=h&&(j+=h)}else h&&(j+=i(f[4],c,d,e));break;case"^":h=d.lookup(g),(!h||v(h)&&0===h.length)&&(j+=i(f[4],c,d,e));break;case">":h=c.getPartial(g),"function"==typeof h&&(j+=h(d));break;case"&":h=d.lookup(g),null!=h&&(j+=h);break;case"name":h=d.lookup(g),null!=h&&(j+=a.escape(h));break;case"text":j+=g}return j}function j(a){for(var b,c=[],d=c,e=[],f=0,g=a.length;g>f;++f)switch(b=a[f],b[0]){case"#":case"^":e.push(b),d.push(b),d=b[4]=[];break;case"/":var h=e.pop();h[5]=b[2],d=e.length>0?e[e.length-1][4]:c;break;default:d.push(b)}return c}function k(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e)b=a[e],b&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(c=b,d.push(b)));return d}function l(a){return[new RegExp(d(a[0])+"\\s*"),new RegExp("\\s*"+d(a[1]))]}function m(b,e){function g(){if(z&&!A)for(;y.length;)delete x[y.pop()];else y=[];z=!1,A=!1}if(b=b||"",e=e||a.tags,"string"==typeof e&&(e=e.split(o)),2!==e.length)throw new Error("Invalid tags: "+e.join(", "));for(var h,i,m,p,t,u=l(e),v=new f(b),w=[],x=[],y=[],z=!1,A=!1;!v.eos();){if(h=v.pos,m=v.scanUntil(u[0]))for(var B=0,C=m.length;C>B;++B)p=m.charAt(B),c(p)?y.push(x.length):A=!0,x.push(["text",p,h,h+1]),h+=1,"\n"==p&&g();if(!v.scan(u[0]))break;if(z=!0,i=v.scan(s)||"name",v.scan(n),"="===i?(m=v.scanUntil(q),v.scan(q),v.scanUntil(u[1])):"{"===i?(m=v.scanUntil(new RegExp("\\s*"+d("}"+e[1]))),v.scan(r),v.scanUntil(u[1]),i="&"):m=v.scanUntil(u[1]),!v.scan(u[1]))throw new Error("Unclosed tag at "+v.pos);if(t=[i,m,h,v.pos],x.push(t),"#"===i||"^"===i)w.push(t);else if("/"===i){if(0===w.length)throw new Error('Unopened section "'+m+'" at '+h);var D=w.pop();if(D[1]!==m)throw new Error('Unclosed section "'+D[1]+'" at '+h)}else if("name"===i||"{"===i||"&"===i)A=!0;else if("="===i){if(e=m.split(o),2!==e.length)throw new Error("Invalid tags at "+h+": "+e.join(", "));u=l(e)}}var D=w.pop();if(D)throw new Error('Unclosed section "'+D[1]+'" at '+v.pos);return x=k(x),j(x)}var n=/\s*/,o=/\s+/,p=/\S/,q=/\s*=/,r=/\s*\}/,s=/#|\^|\/|>|\{|&|=|!/,t=RegExp.prototype.test,u=Object.prototype.toString,v=Array.isArray||function(a){return"[object Array]"===u.call(a)},w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};f.prototype.eos=function(){return""===this.tail},f.prototype.scan=function(a){var b=this.tail.match(a);return b&&0===b.index?(this.tail=this.tail.substring(b[0].length),this.pos+=b[0].length,b[0]):""},f.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c),this.pos+=c}return b},g.make=function(a){return a instanceof g?a:new g(a)},g.prototype.push=function(a){return new g(a,this)},g.prototype.lookup=function(a){var b=this._cache[a];if(!b){if("."==a)b=this.view;else for(var c=this;c;){if(a.indexOf(".")>0){b=c.view;for(var d=a.split("."),e=0;b&&e<d.length;)b=b[d[e++]]}else b=c.view[a];if(null!=b)break;c=c.parent}this._cache[a]=b}return"function"==typeof b&&(b=b.call(this.view)),b},h.prototype.clearCache=function(){this._cache={},this._partialCache={}},h.prototype.compile=function(b,c){var d=this._cache[b];if(!d){var e=a.parse(b,c);d=this._cache[b]=this.compileTokens(e,b)}return d},h.prototype.compilePartial=function(a,b,c){var d=this.compile(b,c);return this._partialCache[a]=d,d},h.prototype.getPartial=function(a){return a in this._partialCache||!this._loadPartial||this.compilePartial(a,this._loadPartial(a)),this._partialCache[a]},h.prototype.compileTokens=function(a,b){var c=this;return function(d,e){if(e)if("function"==typeof e)c._loadPartial=e;else for(var f in e)c.compilePartial(f,e[f]);return i(a,c,g.make(d),b)}},h.prototype.render=function(a,b,c){return this.compile(a)(b,c)},a.name="mustache.js",a.version="0.7.2",a.tags=["{{","}}"],a.Scanner=f,a.Context=g,a.Writer=h,a.parse=m,a.escape=e;var x=new h;a.clearCache=function(){return x.clearCache()},a.compile=function(a,b){return x.compile(a,b)},a.compilePartial=function(a,b,c){return x.compilePartial(a,b,c)},a.compileTokens=function(a,b){return x.compileTokens(a,b)},a.render=function(a,b,c){return x.render(a,b,c)},a.to_html=function(b,c,d,e){var f=a.render(b,c,d);return"function"!=typeof e?f:(e(f),void 0)}}),function(){!function(){"use strict";var a={},b=Array.prototype,c=Object.prototype;Function.prototype;var d=(b.push,b.slice,b.concat,c.toString,c.hasOwnProperty),e=b.forEach,f=b.filter,g={};g.each=function(b,c,d){if(null!=b)if(e&&b.forEach===e)b.forEach(c,d);else if(b.length===+b.length){for(var f=0,h=b.length;h>f;f++)if(c.call(d,b[f],f,b)===a)return}else for(var i in b)if(g.has(b,i)&&c.call(d,b[i],i,b)===a)return},g.filter=function(a,b,c){var d=[];return null==a?d:f&&a.filter===f?a.filter(b,c):(g.each(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},g.isFunction=function(a){return"function"==typeof a},g.has=function(a,b){return d.call(a,b)};var h={};if("undefined"!=typeof exports)"undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports.jsMessage=h;else{if(void 0!==this.jsMessage)throw"jsMessage is allready defined";this.jsMessage=h}h.mixinPubSub=function(a){a=a||{};var b={},c=[];return a.subscribe=function(a,d){a?(b[a]=b[a]||[],b[a].push(d)):c.push(d)},a.unsubscribe=function(a,d){var e=function(c){return g.filter(b[c],function(b){return b!==a})};if(d){if(!b[d])throw"topic not found";b[d]=e(d)}else g.each(b,function(a,c){b[c]=e(c)}),c=g.filter(c,function(b){return b!==a})},a.publish=function(a,d){a?g.each(b[a],function(a){a(d)}):g.each(b,function(a){g.each(a,function(a){a&&a(d)})}),g.each(c,function(a){a(d)})},a.autoPublish=function(a,b){var c,d=this;return function(e){var f;return void 0===e?c:(c=e,f=b?b(e):e,d.publish(a,f),void 0)}},a},h.mixinEvents=function(a,b){var c={},d=b||{};return g.each(a,function(b,e){g.isFunction(b)&&(a[e]=function(){var f,h=b.apply(a,arguments);return c[e]&&(d[e]&&(f=d[e].apply(a,[h])),g.each(c[e],function(a){a(f)})),h})}),a.on=function(a,b){c[a]=c[a]||[],c[a].push(b)},a.off=function(a,b){c[a]=b?g.filter(c[a],function(a){return a!==b}):void 0},a}}.call(this),function(){"use strict";var a="abcdefgh".split(""),b=function(a){if("string"!=typeof a)return!1;var b=a.split("-");return 2!==b.length?!1:c(b[0])===!0&&c(b[1])===!0},c=function(a){return"string"!=typeof a?!1:-1!==a.search(/^[a-h][1-8]$/)},d=function(a){return"string"!=typeof a?!1:-1!==a.search(/^[bw][KQRNBP]$/)},e=function(a){if("string"!=typeof a)return!1;var b=a.split("/");if(b.length<8)return!1;for(var c=0;8>c;c++)if(""===b[c]||b[c].length>8||-1!==b[c].search(/[^kqrbnpKQRNBP1-8]/))return!1;return!0},f=function(a){if("object"!=typeof a)return!1;for(var b in a)if(a.hasOwnProperty(b)===!0&&(c(b)!==!0||d(a[b])!==!0))return!1;return!0},g=function(a){return a.toLowerCase()===a?"b"+a.toUpperCase():"w"+a.toUpperCase()},h=function(a){var b=a.split("");return"w"===b[0]?b[1].toUpperCase():b[1].toLowerCase()},i=function(b){if(e(b)!==!0)return!1;for(var c=b.split("/"),d={},f=8,h=0;8>h;h++){for(var i=c[h].split(""),j=0,k=0;k<i.length;k++)if(-1!==i[k].search(/[1-8]/)){var l=parseInt(i[k],10);j+=l}else{var m=a[j]+f;d[m]=g(i[k]),j++}f--}return d},j=function(b){if(f(b)!==!0)return!1;for(var c="",d=8,e=0;8>e;e++){for(var g=0;8>g;g++){var i=a[g]+d;c+=b.hasOwnProperty(i)===!0?h(b[i]):"1"}7!==e&&(c+="/"),d--}return c=c.replace(/11111111/g,"8"),c=c.replace(/1111111/g,"7"),c=c.replace(/111111/g,"6"),c=c.replace(/11111/g,"5"),c=c.replace(/1111/g,"4"),c=c.replace(/111/g,"3"),c=c.replace(/11/g,"2")};window.ChessBoard=window.ChessBoard||function(d,g){g=g||{};var h,k,l,m,n,o,p,q,r,s,t="1.7.0",u="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",v=i(u),w={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7"},x={},y=!1,z=2,A="white",B={},C=!1,D={},E={},F=function(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(){var a=0|16*Math.random();return a.toString(16)})},G=function(a){return JSON.parse(JSON.stringify(a))},H=function(a){var b=a.split(".");return{major:parseInt(b[0],10),minor:parseInt(b[1],10),patch:parseInt(b[2],10)}},I=function(a,b){a=H(a),b=H(b);var c=1e4*1e4*a.major+1e4*a.minor+a.patch,d=1e4*1e4*b.major+1e4*b.minor+b.patch;return c>=d},J=function(a,b,c){if(g.hasOwnProperty("showErrors")===!0&&g.showErrors!==!1){var d="ChessBoard Error "+a+": "+b;return"console"===g.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(d),arguments.length>=2&&console.log(c),void 0):"alert"===g.showErrors?(c&&(d+="\n\n"+JSON.stringify(c)),window.alert(d),void 0):("function"==typeof g.showErrors&&g.showErrors(a,b,c),void 0)}},K=function(){if("string"==typeof d){if(""===d)return window.alert("ChessBoard Error 1001: The first argument to ChessBoard() cannot be an empty string.\n\nExiting..."),!1;var a=document.getElementById(d);if(!a)return window.alert('ChessBoard Error 1002: Element with id "'+d+'" does not exist in the DOM.'+"\n\nExiting..."),!1;h=$(a)}else if(h=$(d),1!==h.length)return window.alert("ChessBoard Error 1003: The first argument to ChessBoard() must be an ID or a single DOM node.\n\nExiting..."),!1;return window.JSON&&"function"==typeof JSON.stringify&&"function"==typeof JSON.parse?$.fn&&$.fn.jquery&&I($.fn.jquery,t)===!0?!0:(window.alert("ChessBoard Error 1005: Unable to find a valid version of jQuery. Please include jQuery "+t+" or "+"higher on the page.\n\nExiting..."),!1):(window.alert("ChessBoard Error 1004: JSON does not exist. Please include a JSON polyfill.\n\nExiting..."),!1)},L=function(a){return"fast"===a||"slow"===a?!0:parseInt(a,10)+""!=a+""?!1:a>0},M=function(){return("string"==typeof g||f(g)===!0)&&(g={position:g}),"black"!==g.orientation&&(g.orientation="white"),A=g.orientation,g.showNotation!==!1&&(g.showNotation=!0),g.draggable!==!0&&(g.draggable=!1),"trash"!==g.dropOffBoard&&(g.dropOffBoard="snapback"),g.sparePieces!==!0&&(g.sparePieces=!1),g.sparePieces===!0&&(g.draggable=!0),(g.hasOwnProperty("pieceTheme")!==!0||"string"!=typeof g.pieceTheme&&"function"!=typeof g.pieceTheme)&&(g.pieceTheme="img/chesspieces/wikipedia/{piece}.png"),(g.hasOwnProperty("moveSpeed")!==!0||L(g.moveSpeed)!==!0)&&(g.moveSpeed=200),(g.hasOwnProperty("snapbackSpeed")!==!0||L(g.snapbackSpeed)!==!0)&&(g.snapbackSpeed=50),(g.hasOwnProperty("snapSpeed")!==!0||L(g.snapSpeed)!==!0)&&(g.snapSpeed=25),(g.hasOwnProperty("trashSpeed")!==!0||L(g.trashSpeed)!==!0)&&(g.trashSpeed=100),g.hasOwnProperty("position")===!0&&("start"===g.position?B=G(v):e(g.position)===!0?B=i(g.position):f(g.position)===!0?B=G(g.position):J(7263,"Invalid value passed to config.position.",g.position)),!0},N=function(){var a=parseInt(h.css("width"),10);if(!a||0>=a)return 0;for(var b=a-1;0!==b%8&&b>0;)b--;return b/8},O=function(){for(var b=0;b<a.length;b++)for(var c=1;8>=c;c++){var d=a[b]+c;E[d]=d+"-"+F()}for(var e="KQRBNP".split(""),b=0;b<e.length;b++){var f="w"+e[b],g="b"+e[b];D[f]=f+"-"+F(),D[g]=g+"-"+F()}},P=function(){var a='<div class="'+w.chessboard+'">';return g.sparePieces===!0&&(a+='<div class="'+w.sparePieces+" "+w.sparePiecesTop+'"></div>'),a+='<div class="'+w.board+'"></div>',g.sparePieces===!0&&(a+='<div class="'+w.sparePieces+" "+w.sparePiecesBottom+'"></div>'),a+="</div>"},Q=function(b){"black"!==b&&(b="white");var c="",d=G(a),e=8;"black"===b&&(d.reverse(),e=1);for(var f="white",h=0;8>h;h++){c+='<div class="'+w.row+'">';for(var i=0;8>i;i++){var j=d[i]+e;c+='<div class="'+w.square+" "+w[f]+'" '+'style="width: '+o+"px; height: "+o+'px" '+'id="'+E[j]+'" '+'data-square="'+j+'">',g.showNotation===!0&&(("white"===b&&1===e||"black"===b&&8===e)&&(c+='<div class="'+w.notation+" "+w.alpha+'">'+d[i]+"</div>"),0===i&&(c+='<div class="'+w.notation+" "+w.numeric+'">'+e+"</div>")),c+="</div>",f="white"===f?"black":"white"}c+='<div class="'+w.clearfix+'"></div></div>',f="white"===f?"black":"white","white"===b?e--:e++}return c},R=function(a){return"function"==typeof g.pieceTheme?g.pieceTheme(a):"string"==typeof g.pieceTheme?g.pieceTheme.replace(/{piece}/g,a):(J(8272,"Unable to build image source for cfg.pieceTheme."),void 0)},S=function(a,b,c){var d='<img src="'+R(a)+'" ';return c&&"string"==typeof c&&(d+='id="'+c+'" '),d+='alt="" class="'+w.piece+'" '+'data-piece="'+a+'" '+'style="width: '+o+"px;"+"height: "+o+"px;",b===!0&&(d+="display:none;"),d+='" />'},T=function(a){var b=["wK","wQ","wR","wB","wN","wP"];"black"===a&&(b=["bK","bQ","bR","bB","bN","bP"]);for(var c="",d=0;d<b.length;d++)c+=S(b[d],!1,D[b[d]]);return c},U=function(a,b,c,d){var e=$("#"+E[a]),f=e.offset(),h=$("#"+E[b]),i=h.offset(),j=F();$("body").append(S(c,!0,j));var k=$("#"+j);k.css({display:"",position:"absolute",top:f.top,left:f.left}),e.find("img."+w.piece).remove();var l=function(){h.append(S(c)),k.remove(),"function"==typeof d&&d()},m={duration:g.moveSpeed,complete:l};k.animate(i,m)},V=function(a,b,c){var d=$("#"+D[a]).offset(),e=$("#"+E[b]),f=e.offset(),h=F();$("body").append(S(a,!0,h));var i=$("#"+h);i.css({display:"",position:"absolute",left:d.left,top:d.top});var j=function(){e.find("img."+w.piece).remove(),e.append(S(a)),i.remove(),"function"==typeof c&&c()},k={duration:g.moveSpeed,complete:j};i.animate(f,k)},W=function(a){y=!0;for(var b=0,c=function(){b++,b===a.length&&(bb(),y=!1)},d=0;d<a.length;d++)"clear"===a[d].type&&$("#"+E[a[d].square]+" img."+w.piece).fadeOut(g.trashSpeed,c),"add"===a[d].type&&g.sparePieces!==!0&&$("#"+E[a[d].square]).append(S(a[d].piece,!0)).find("img."+w.piece).fadeIn("fast",c),"add"===a[d].type&&g.sparePieces===!0&&V(a[d].piece,a[d].square,c),"move"===a[d].type&&U(a[d].source,a[d].destination,a[d].piece,c)},X=function(b,c){b=b.split("");var d=a.indexOf(b[0])+1,e=parseInt(b[1],10);c=c.split("");var f=a.indexOf(c[0])+1,g=parseInt(c[1],10),h=Math.abs(d-f),i=Math.abs(e-g);return h>=i?h:i},Y=function(b){for(var c=[],d=0;8>d;d++)for(var e=0;8>e;e++){var f=a[d]+(e+1);b!==f&&c.push({square:f,distance:X(b,f)})}c.sort(function(a,b){return a.distance-b.distance});for(var g=[],d=0;d<c.length;d++)g.push(c[d].square);return g},Z=function(a,b,c){for(var d=Y(c),e=0;e<d.length;e++){var f=d[e];if(a.hasOwnProperty(f)===!0&&a[f]===b)return f}return!1},_=function(a,b){a=G(a),b=G(b);var c=[],d={};for(var e in b)b.hasOwnProperty(e)===!0&&a.hasOwnProperty(e)===!0&&a[e]===b[e]&&(delete a[e],delete b[e]);for(var e in b)if(b.hasOwnProperty(e)===!0){var f=Z(a,b[e],e);f!==!1&&(c.push({type:"move",source:f,destination:e,piece:b[e]}),delete a[f],delete b[e],d[e]=!0)}for(var e in b)b.hasOwnProperty(e)===!0&&(c.push({type:"add",square:e,piece:b[e]}),delete b[e]);for(var e in a)a.hasOwnProperty(e)===!0&&d.hasOwnProperty(e)!==!0&&(c.push({type:"clear",square:e,piece:a[e]}),delete a[e]);return c},ab=function(){k.find("img."+w.piece).remove()},bb=function(){ab();for(var a in B)B.hasOwnProperty(a)===!0&&$("#"+E[a]).append(S(B[a]))},cb=function(){k.html(Q(A)),bb(),g.sparePieces===!0&&("white"===A?(m.html(T("black")),n.html(T("white"))):(m.html(T("white")),n.html(T("black"))))},db=function(a,b){W(_(a,b))},eb=function(a,b){a=G(a);for(var c in b)if(b.hasOwnProperty(c)===!0&&a.hasOwnProperty(c)===!0){var d=a[c];delete a[c],a[b[c]]=d}return a},fb=function(a){var b=G(B),c=G(a),d=j(b),e=j(c);d!==e&&(g.hasOwnProperty("onChange")===!0&&"function"==typeof g.onChange&&g.onChange(b,c),B=a)},gb=function(a,b){for(var c in s)if(s.hasOwnProperty(c)===!0){var d=s[c];if(a>=d.left&&a<d.left+o&&b>=d.top&&b<d.top+o)return c}return"offboard"},hb=function(){s={};for(var a in E)E.hasOwnProperty(a)===!0&&(s[a]=$("#"+E[a]).offset())},ib=function(){k.find("div."+w.square).removeClass(w.highlight1+" "+w.highlight2)},jb=function(){if("spare"===r)return kb(),void 0;ib();var a=function(){bb(),l.css("display","none")},b=$("#"+E[r]).offset(),c={duration:g.snapbackSpeed,complete:a};l.animate(b,c),C=!1},kb=function(){ib();var a=G(B);delete a[r],fb(a),bb(),l.fadeOut(g.trashSpeed),C=!1},lb=function(a){ib();var b=G(B);delete b[r],b[a]=p,fb(b);var c=$("#"+E[a]).offset(),d=function(){bb(),l.css("display","none")},e={duration:g.snapSpeed,complete:d};l.animate(c,e),C=!1},mb=function(a,b,c,d){("function"!=typeof g.onDragStart||g.onDragStart(a,b,G(B),A)!==!1)&&(C=!0,p=b,r=a,q="spare"===a?"offboard":a,hb(),l.attr("src",R(b)).css({display:"",position:"absolute",left:c-o/2,top:d-o/2}),"spare"!==a&&$("#"+E[a]).addClass(w.highlight1).find("img."+w.piece).css("display","none"))},nb=function(a,b){l.css({left:a-o/2,top:b-o/2});var d=gb(a,b);d!==q&&(c(q)===!0&&$("#"+E[q]).removeClass(w.highlight2),c(d)===!0&&$("#"+E[d]).addClass(w.highlight2),"function"==typeof g.onDragMove&&g.onDragMove(d,q,r,p,G(B),A),q=d)},ob=function(a){var b="drop";if("offboard"===a&&"snapback"===g.dropOffBoard&&(b="snapback"),"offboard"===a&&"trash"===g.dropOffBoard&&(b="trash"),g.hasOwnProperty("onDrop")===!0&&"function"==typeof g.onDrop){var d=G(B);"spare"===r&&c(a)===!0&&(d[a]=p),c(r)===!0&&"offboard"===a&&delete d[r],c(r)===!0&&c(a)===!0&&(delete d[r],d[a]=p);var e=G(B),f=g.onDrop(r,a,p,d,e,A);("snapback"===f||"trash"===f)&&(b=f)
}"snapback"===b?jb():"trash"===b?kb():"drop"===b&&lb(a)};x.clear=function(a){x.position({},a)},x.destroy=function(){h.html(""),l.remove(),h.unbind()},x.fen=function(){return x.position("fen")},x.flip=function(){x.orientation("flip")},x.move=function(){if(0!==arguments.length){for(var a={},c=0;c<arguments.length;c++)if(b(arguments[c])===!0){var d=arguments[c].split("-");a[d[0]]=d[1]}else J(2826,"Invalid move passed to the move method.",arguments[c]);var e=eb(B,a);return x.position(e),e}},x.orientation=function(a){return 0===arguments.length?A:"white"===a||"black"===a?(A=a,cb(),void 0):"flip"===a?(A="white"===A?"black":"white",cb(),void 0):(J(5482,"Invalid value passed to the orientation method.",a),void 0)},x.position=function(a,b){return 0===arguments.length?G(B):"string"==typeof a&&"fen"===a.toLowerCase()?j(B):(b!==!1&&(b=!0),"string"==typeof a&&"start"===a.toLowerCase()&&(a=G(v)),e(a)===!0&&(a=i(a)),f(a)!==!0?(J(6482,"Invalid value passed to the position method.",a),void 0):(b===!0?(db(B,a),fb(a)):(fb(a),bb()),void 0))},x.resize=function(){o=N(),k.css("width",8*o+"px"),l.css({height:o,width:o}),g.sparePieces===!0&&h.find("div."+w.sparePieces).css("paddingLeft",o+z+"px"),cb()},x.start=function(a){x.position("start",a)};var pb=function(){return"ontouchstart"in document.documentElement},qb=function(){return navigator&&navigator.userAgent&&-1!==navigator.userAgent.search(/MSIE/)},rb=function(a){a.preventDefault()},sb=function(a){if(g.draggable===!0){var b=$(this).attr("data-square");c(b)===!0&&B.hasOwnProperty(b)===!0&&mb(b,B[b],a.pageX,a.pageY)}},tb=function(a){if(g.draggable===!0){var b=$(this).attr("data-square");c(b)===!0&&B.hasOwnProperty(b)===!0&&(a=a.originalEvent,mb(b,B[b],a.changedTouches[0].pageX,a.changedTouches[0].pageY))}},ub=function(a){if(g.sparePieces===!0){var b=$(this).attr("data-piece");mb("spare",b,a.pageX,a.pageY)}},vb=function(a){if(g.sparePieces===!0){var b=$(this).attr("data-piece");a=a.originalEvent,mb("spare",b,a.changedTouches[0].pageX,a.changedTouches[0].pageY)}},wb=function(a){C===!0&&nb(a.pageX,a.pageY)},xb=function(a){C===!0&&(a.preventDefault(),nb(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY))},yb=function(a){if(C===!0){var b=gb(a.pageX,a.pageY);ob(b)}},zb=function(a){if(C===!0){var b=gb(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY);ob(b)}},Ab=function(){$("body").on("mousedown mousemove","img."+w.piece,rb),k.on("mousedown","div."+w.square,sb),h.on("mousedown","div."+w.sparePieces+" img."+w.piece,ub),qb()===!0?(document.ondragstart=function(){return!1},$("body").on("mousemove",wb),$("body").on("mouseup",yb)):($(window).on("mousemove",wb),$(window).on("mouseup",yb)),pb()===!0&&(k.on("touchstart","div."+w.square,tb),h.on("touchstart","div."+w.sparePieces+" img."+w.piece,vb),$(window).on("touchmove",xb),$(window).on("touchend",zb))},Bb=function(){h.html(P()),k=h.find("div."+w.board),g.sparePieces===!0&&(m=h.find("div."+w.sparePiecesTop),n=h.find("div."+w.sparePiecesBottom));var a=F();$("body").append(S("wP",!0,a)),l=$("#"+a),z=parseInt(k.css("borderLeftWidth"),10),x.resize()},Cb=function(){K()===!0&&M()===!0&&(O(),Bb(),Ab())};return Cb(),x},window.ChessBoard.fenToObj=i,window.ChessBoard.objToFen=j}(),_.mixin({pad:function(a,b){return this.map(this.range(a),function(){return b})}});var a={king:"k",queen:"q",rook:"r",knight:"n",bishop:"b",pawn:"p"},b={black:"b",white:"w"};!function(){"use strict";var c={};this.createPieceModel=c;var d=function(a,c,d){c=c||{};var e={};e.side=function(){return d.side},e.type=function(){return a},e.getMoves=function(a,b){d.tempBoard=b;var c=d.getMoves(a);return d.tempBoard=void 0,c},d.tempBoard=void 0,d.side=c.side,d.isOnBoard=function(a){return a.x>=0&&a.x<8&&a.y>=0&&a.y<8};var f=function(a){return d.isOnBoard(a)?d.tempBoard[a.y][a.x]:void 0},g=function(a){var b=f(a);return b&&b.side()};d.isOpponent=function(a){var c=g(a),d=e.side();return c===b.white&&d===b.black||c===b.black&&d===b.white},d.isAlly=function(a){return g(a)===e.side()};var h=function(a,b,c){for(var e=b(a),f=c(a),g=i(),h=i(),j=[];d.isOnBoard(e)&&!g(e);)j.push(e),e=b(e);for(;d.isOnBoard(f)&&!h(f);)j.push(f),f=c(f);return j},i=function(){var a=!1;return function(b){var c=!1;return a?c=!0:d.isAlly(b)?c=!0:d.isOpponent(b)&&(a=!0),c}};d.advance=function(a,b,c){return{x:c.x+a,y:c.y+b}};var j=function(a,b){return _.partial(d.advance,a,b)};return d.horizontal=function(a){return h(a,j(-1,0),j(1,0))},d.vertical=function(a){return h(a,j(0,1),j(0,-1))},d.rising=function(a){return h(a,j(1,-1),j(-1,1))},d.falling=function(a){return h(a,j(1,1),j(-1,-1))},e};c.king=function(b){b=b||{};var c={},e=d(a.king,b,c);return e.isMoved=!1,c.getMoves=function(a){return _.filter(_.map([[1,1],[1,0],[1,-1],[0,1],[0,-1],[-1,1],[-1,0],[-1,-1]],function(b){return c.advance(b[0],b[1],a)}),function(a){return c.isOnBoard(a)&&!c.isAlly(a)})},e},c.queen=function(b){b=b||{};var c={},e=d(a.queen,b,c);return c.getMoves=function(a){return _.union(c.horizontal(a),c.vertical(a),c.rising(a),c.falling(a))},e},c.rook=function(b){b=b||{};var c={},e=d(a.rook,b,c);return e.isMoved=!1,c.getMoves=function(a){return _.union(c.horizontal(a),c.vertical(a))},e},c.bishop=function(b){b=b||{};var c={},e=d(a.bishop,b,c);return c.getMoves=function(a){return _.union(c.rising(a),c.falling(a))},e},c.knight=function(b){b=b||{};var c={},e=d(a.knight,b,c);return c.getMoves=function(a){return _.filter(_.map([[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]],function(b){return c.advance(b[0],b[1],a)}),function(a){return c.isOnBoard(a)&&!c.isAlly(a)})},e},c.pawn=function(c){c=c||{};var e={},f=d(a.pawn,c,e),g=function(a){var c,d,g=[];return f.side()===b.black?(c=1,d=1):(c=-1,d=6),g.push({x:a.x,y:a.y+c}),a.y===d&&g.push({x:a.x,y:a.y+2*c}),_.filter(g,function(a){return e.isOnBoard(a)&&!e.isOpponent(a)&&!e.isAlly(a)})},h=function(a){var c=f.side()===b.black?1:-1;return _.filter([{x:a.x+1,y:a.y+c},{x:a.x-1,y:a.y+c}],e.isOpponent)};return e.getMoves=function(a){return _.union(g(a),h(a))},f.isEnPassant=!1,f}}.call(this),createBoardModel=function(c){"use strict";c=c||{};var d=jsMessage.mixinPubSub(),e=function(a){return _.map(a,function(a){return _.map(a,function(a){return a&&{side:a.side(),type:a.type()}})})},f=d.autoPublish("board",e),g=d.autoPublish("side"),h=!1,i=function(){var a=function(a){return _.map(["rook","knight","bishop","queen","king","bishop","knight","rook"],function(b){return createPieceModel[b]({side:a})})},c=function(){return _.pad(8,null)},d=function(a){return _.map(_.range(8),function(){return createPieceModel.pawn({side:a})})};return function(){return[a(b.black),d(b.black),c(),c(),c(),c(),d(b.white),a(b.white)]}}(),j=function(b){return _.map(b,function(b){return _.map(b,function(b){var c;return b?(c=_.invert(a)[b.type()],createPieceModel[c]({side:b.side()})):null})})},k=function(a,b){return b?b[a.y][a.x]:f()[a.y][a.x]},l=function(a,b,c){if(c)c[b.y][b.x]=a;else{var d=f();d[b.y][b.x]=a,f(d)}},m=function(b){t(b,function(b){b&&b.type()===a.pawn&&(b.isEnPassant=!1)})},n=function(b,c,d){var e=k(b,d);m(d||f()),e&&(e.type()===a.king||e.type()===a.rook?e.isMoved=!0:e.type()===a.pawn&&2===Math.abs(b.y-c.y)&&(e.isEnPassant=!0)),l(e,c,d),l(null,b,d)},o=function(a){var c=a||g();return c===b.black?b.white:b.black},p=function(){g(o())},q=function(a){var b=k(a);return b&&b.side()===g()},r=function(a,b){return _.find(k(a).getMoves(a,f()),_.partial(_.isEqual,b))?!0:!1},s=function(b){var c={};return t(b,function(b,d){b&&b.type()===a.king&&(c[b.side()]=d)}),c},t=function(a,b){var c,d,e;for(d=0;d<a.length;d+=1)for(e=a[d],c=0;c<e.length;c+=1)b(k({x:c,y:d},a),{x:c,y:d})},u=function(a){var b=s(a)[g()],c=!1;return t(a,function(d,e){d&&d.side()===o(g())&&_.each(d.getMoves(e,a),function(a){_.isEqual(a,b)&&(c=!0)})}),c},v=function(a,b){return!(4!==a.x||0!==a.y&&7!==a.y||6!==b.x&&2!==b.x||a.y!==b.y)},w=function(a){return 6===a.x?{x:7,y:a.y}:{x:0,y:a.y}},x=function(a){return 6===a.x?{x:5,y:a.y}:{x:3,y:a.y}},y=function(b){var c=w(b),d=k(c);return d&&d.side()===g()&&d.type()===a.rook},z=function(a,b){var c=j(f());return n(a,b,c),n(w(b),x(b),c),u(c)},A=function(a,b){var c=j(f());return n(a,{x:2===b.x?a.x-1:a.x+1,y:b.y},c),u(c)},B=function(){var a=k(s(f())[g()]);return!a.isMoved},C=function(b){var c=k(w(b));return c&&c.type()===a.rook&&!c.isMoved},D=function(a,b){n(a,b),n(w(b),x(b))},E=function(a){return 6===a.x?null===k({x:5,y:a.y})&&null===k({x:6,y:a.y}):null===k({x:3,y:a.y})&&null===k({x:2,y:a.y})&&null===k({x:1,y:a.y})},F=function(a,b){var c=j(f());return n(a,b,c),u(c)},G=function(c,d){var e=k(c),f=k({x:d.x,y:c.y});return e&&e.type()===a.pawn&&1===Math.abs(c.x-d.x)&&1===Math.abs(c.y-d.y)&&null===k(d)&&f.type()===a.pawn&&f.side()===o()&&f.isEnPassant?g()===b.white?c.y-d.y>0:c.y-d.y<0:!1},H=function(c,d){var e=k(c);return e&&e.type()===a.pawn&&(e.side()===b.white&&0===d.y||e.side()===b.black&&7===d.y)&&r(c,d)};c.board&&f(c.board),c.side&&g(c.side),d.newGame=function(){f(i()),g(b.white),d.publish("newGame",{})};var I=function(){var c,d=g()===b.black?7:0;return t(f(),function(b,e){e.y===d&&b&&b.type()===a.pawn&&b.side()===g()&&(c=e)}),c};return d.promotePawn=function(b){var c=I(),d=k(c),e=_.invert(a)[b];!d||d.type()!==a.pawn||0!==c.y&&7!==c.y||(l(createPieceModel[e]({side:g()}),c),p(),h=!1)},d.isOwnPiece=function(a){return q(a)},d.makeMove=function(a,b){var c;return q(a)&&!h?v(a,b)?y(b)&&B()&&C(b)&&E(b)&&!z(a,b)&&!A(a,b)?(D(a,b),p(),c=!0):c=!1:G(a,b)&&!F(a,b)?(l(null,{x:b.x,y:a.y}),n(a,b),p(),c=!0):H(a,b)&&!F(a,b)?(n(a,b),h=!0,c=!0,d.publish("pawnPromotion",g())):r(a,b)&&!F(a,b)?(n(a,b),p(),c=!0):c=!1:c=!1,c},d};var c=function(c){c=c||{};var d=jsMessage.mixinPubSub(),e=c.model||createBoardModel(),f=c.view||new ChessBoard("board"),g=null,h={P:a.pawn,R:a.rook,N:a.knight,B:a.bishop,K:a.king,Q:a.queen},i={b:b.black,w:b.white},j=function(a){return _.invert(i)[a.side]+_.invert(h)[a.type]},k=function(a){return{x:a.charCodeAt(0)-97,y:8-Number(a.charAt(1))}},l=function(a){return String.fromCharCode(a.x+97)+String(8-a.y)},m=function(a){var b={};return _.each(a,function(a,c){return _.each(a,function(a,d){if(a){var e=l({x:d,y:c});b[e]=j(a)}})}),b};return d.newGame=function(){},d.loadGame=function(){},d.bindSquareClick=function(){$(".square-55d63").click(function(){$(".square-55d63").removeClass("selected"),d.clickSquare($(this).attr("data-square"))&&$(this).addClass("selected")})},d.bindPawnPromotionSelect=function(){$("#bQ").click(function(){$("#select-piece-black").modal("hide"),e.promotePawn(a.queen)}),$("#bN").click(function(){$("#select-piece-black").modal("hide"),e.promotePawn(a.knight)}),$("#wQ").click(function(){$("#select-piece-white").modal("hide"),e.promotePawn(a.queen)}),$("#wN").click(function(){$("#select-piece-white").modal("hide"),e.promotePawn(a.knight)})},d.boardUpdate=function(a){f.position(m(a))},d.promotePawn=function(a){var c=a===b.black?"black":"white";$("#select-piece-"+c).modal()},d.sideUpdate=function(a){var c=200;$("#status-indicator").html(a===b.white?"White's move.":"Black's move."),$("#is-change-orientation").is(":checked")&&setTimeout(function(){$("#board img").fadeOut(c),setTimeout(function(){f.orientation(a===b.white?"white":"black");var e=$("#board img");e.hide(),e.fadeIn(c),d.bindSquareClick()},c)},c)},d.clickSquare=function(a){var b=k(a);return g?e.isOwnPiece(b)?g=b:(e.makeMove(g,b),g=null):e.isOwnPiece(b)&&(g=b),g?!0:!1},d};$(document).ready(function(){"use strict";var a=new ChessBoard("board",{showNotation:!1}),b=createBoardModel(),d=c({model:b,view:a});b.subscribe("board",_.bind(d.boardUpdate,d)),b.newGame(),b.subscribe("side",_.bind(d.sideUpdate,d)),b.subscribe("pawnPromotion",_.bind(d.promotePawn,d));var e=function(){var b=$("#board"),c=$("#controls"),d=$(window).width(),e=$(window).height();b.width(_.min([d,e])-1),a.resize(),d>e?(c.width(d-e-5),c.addClass("horizontal-controls")):(c.width(d),c.removeClass("horizontal-controls"))};e(),$(window).resize(e),$(window).resize(function(){a.resize(arguments),d.bindSquareClick()}),d.bindSquareClick(),d.bindPawnPromotionSelect()})}();